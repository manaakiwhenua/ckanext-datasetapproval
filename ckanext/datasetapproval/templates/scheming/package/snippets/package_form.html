{% ckan_extends %}

{% block basic_fields %}
    {{ super() }}
    <input id="field-publishing_status" type="hidden" name="publishing_status" value="{{data.publishing_status}}" placeholder=""
                class="form-control">
{% endblock %}

{% block stages %}
  {% if not h.is_admin(c.user) %}
    {% snippet "snippets/dataset_approval_alert_note.html" %}
  {% endif %}
  {% if form_style != 'edit' %}
    {{ super() }}
  {% endif %}
{% endblock %}

{% block save_button %}
  {% asset 'datasetapproval/datasetapproval_org_js' %}
    <!-- button that is for saving in progress - available on both create and edit -->
  {% if form_style == 'edit' %}
  {% set selected_org = pkg_dict.owner_org %}
    {% if not h.is_admin(c.user, selected_org) %}
      <button class="btn btn-secondary" type="submit" name="save" >{{ _('Save as in progress') }}</button>
    {% endif %}
        {% if h.is_admin(c.user, selected_org) %}
          <button class="btn btn-primary" type="submit" name="save" value="submit-review" >
            {{ h.humanize_entity_type('package', pkg_dict.type, 'update label') or _('Update Dataset') }}
          </button> 
        {% else %}
          {% set publishing_status = pkg_dict.get('publishing_status') %}
          {% if publishing_status in ['approved'] %}
            <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#submitReview" id="submitButton">
              {{ _('Submit for Review') }}
            </button>
          {% else %}
            <button class="btn btn-primary" type="submit" name="save" value="submit-review" id="submitButton">{{ _('Submit for Review') }}</button>
          {% endif %}
        {% endif %}   
  {% else %}
    <button class="btn btn-primary" type="submit" name="save" >{{ _('Next: Add Data') }}</button>
  {% endif %}
  <div class="modal" tabindex="-1" id="submitReview">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Submitting for review</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-start">This dataset has previously been approved, are you sure you wish to submit this for review again?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" type="submit" name="save" value="submit-review">Submit</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}